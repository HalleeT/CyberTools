import nmap 

def vulnerability_scan(target):
    #Initialze Nmap scanner
    scanner = nmap.PortScanner()

    #Perform version detection and vulnerability scanning
    scanner.scan(target, arguments='-sV --script vulners')

    #Iterate over scanned hosts
    for host in scanner.all_hosts():
        print(f"Scanning host: {host}")

        #Iterate over scanned ports for each host
        for proto in scanner[host].all_protocols():
            print(f"Protocol: {proto}")

        # Get list of open ports
        open_ports = scanner[host][proto].keys()
        for port in open_ports:
            print(f"Port: {port} - State: {scanner[host][proto][port]['state']}")

            # Get Vulnerabilty info for open ports
            if 'script' in scanner[host][proto][port]:
                vulnerabilities = scanner[host][proto][port]['script']['vulners']
                print("vulnerabilities:")
                for vulnerability in vulnerabilities:
                    print(f"- {vulnerability}")
        
        if __name__ == "__main__":
            target_ip = '127.0.0.1' # Replace with your target IP address
            vulnerability_scan(target_ip)
            